<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,200;0,400;0,500;0,600;0,700;1,300;1,400&family=Inter&display=swap" rel="stylesheet">
  <title>julio.lol</title>
  <link id="stylesheet" 
        rel="stylesheet" 
        type="text/css" 
        href="https://jxlxx.github.io/julio.lol/base.css">
</head>
    
<body>
  <script>
  
  const cls = document.body.classList;
  
  (function initTheme() {
    let theme = localStorage.getItem("theme");
    if(theme == "dark") {
      cls.toggle("dark", true);
      cls.toggle("light", false);
    } else {
      cls.toggle("dark", false);
      cls.toggle("light", true);
    }
  })();
  
  
  window.addEventListener("load", (evt) => {
    document.getElementById("dark-mode").addEventListener("click", function(e) {
      localStorage.setItem("theme", "light");
      cls.toggle("dark", false);
      cls.toggle("light", true);
    });
    document.getElementById("light-mode").addEventListener("click", function(e) {
      localStorage.setItem("theme", "dark");
      cls.toggle("light", false)
      cls.toggle("dark", true)
    });
  })
  
  
  </script>
  <div class="header">
    <h1 class="title">
      <span class="hash"> # </span>
      <a href="https://jxlxx.github.io/julio.lol"> julio.lol </a>
      <span id="dark-mode"  class="theme-toggle">üåù</span>
      <span id="light-mode" class="theme-toggle">üåö</span>
    </h1>
    <a class="link" 
       href="https://jxlxx.github.io/julio.lol/about">
    about</a>
    <a class="link" 
       href="https://jxlxx.github.io/julio.lol/projects">
    projects</a>
    <a class="link" 
       href="https://jxlxx.github.io/julio.lol/posts">
    posts</a>
    <a class="link" 
       href="https://jxlxx.github.io/julio.lol/contact">
    contact</a>
  </div>

  <section class="section">
    <div class="container">
      

<div class="go-back">

 <a href="https://jxlxx.github.io/julio.lol"> <span class="left-arrow">‚á¶</span>  go back</a>


</div>

<h1 class="title">
  AWS CDK Basics
</h1>
  Talking notes for an AWS CDK workshop.
<p class="subtitle"><strong>2022-07-20</strong></p>
<h1 id="what-is-cdk">What is CDK?</h1>
<p>Cloud Development Kit.</p>
<p>Imagine‚Ä¶ You are running some kind of software business.</p>
<p>You‚Äôre most likely not self-hosting, and instead using some kind of cloud provider.</p>
<p>Something like: AWS, GCP, Digital Ocean, Linode‚Ä¶ etc.</p>
<p>What are the kinds of services you need? </p>
<table><thead><tr><th>Domain Name</th><th>Route53</th></tr></thead><tbody>
<tr><td>SSL</td><td>Certificate Manager</td></tr>
<tr><td>CDN</td><td>CloudFront</td></tr>
<tr><td>Static Assets, etc</td><td>S3</td></tr>
<tr><td>Database</td><td>RDS, Dynamo, Aurora, etc</td></tr>
<tr><td>Authentication</td><td>Cognito</td></tr>
<tr><td>REST API</td><td>API Gateway</td></tr>
<tr><td>Business Logic Stuff</td><td>Lambda, EC2</td></tr>
<tr><td>Container management</td><td>ECR</td></tr>
</tbody></table>
<p>You also probably want a Dev, Stag, and Prod stack.</p>
<p>So a CDK is code that you write, which generates CloudFormation Templates (JSON or YAML), which you push to AWS CloudFormation, and then that builds your AWS infrastructure.</p>
<p>And CloudFormation Templates are ANNOYING. </p>
<h1 id="how-to-start-a-cdk-project">How to start a CDK project</h1>
<p>Get the code: <code>git checkout v1</code></p>
<p>Every CDK app should be in its own directory.</p>
<p>For this tutorial, all my code is in <code>/BackendGuild</code>. So I did:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">mkdir</span><span> CDKWorkshop
</span></code></pre>
<p>CDK apps can be written in a bunch of languages:</p>
<ul>
<li>typescript</li>
<li>javascript</li>
<li>python</li>
<li>java</li>
<li>C#</li>
<li>Go</li>
</ul>
<p>I went with typescript because it has types, everyone can understand it, and it has the most examples and documentation out of all the languages listed by a huuuuge margin. </p>
<p>Globally install <code>aws-cdk</code> and <code>typescript</code> with <code>npm</code>. You also need the <code>aws-cli</code>.</p>
<pre data-lang="tsx" style="background-color:#2b303b;color:#c0c5ce;" class="language-tsx "><code class="language-tsx" data-lang="tsx"><span style="color:#bf616a;">cdk init app </span><span>--</span><span style="color:#bf616a;">language typescript
</span></code></pre>
<h1 id="project-structure">Project Structure</h1>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">lib/name-stack.ts </span><span style="color:#65737e;"># where you spend most of your time
</span><span>                  </span><span style="color:#65737e;"># where the CDK main stack is defined
</span><span>
</span><span style="color:#bf616a;">bin/name.ts </span><span style="color:#65737e;"># enypoint of the CDK app
</span><span>            </span><span style="color:#65737e;"># loads the stack defined in ^^
</span><span>            </span><span style="color:#65737e;"># call stuff in lib and instantiate it
</span><span>
</span><span style="color:#bf616a;">package.json  </span><span style="color:#65737e;"># npm module manifest, build/run scripts etc
</span><span>
</span><span style="color:#bf616a;">cdk.json      </span><span style="color:#65737e;"># &quot;toolkit&quot; how to run your app
</span><span>
</span><span style="color:#bf616a;">tsconfig.json </span><span style="color:#65737e;"># typescript configuration
</span><span>
</span><span style="color:#bf616a;">node_modules/ </span><span style="color:#65737e;"># project dependencies
</span><span>
</span></code></pre>
<ul>
<li>2 directories</li>
<li>node dependency folder</li>
<li>a bunch of config files</li>
</ul>
<h2 id="a-note-on-the-lingo">A note on the lingo</h2>
<p>Everything that the init command just created is called a CDK app.</p>
<p>Inside the app there are ‚Äústacks‚Äù</p>
<p>Inside the stacks there are ‚Äúconstructs‚Äù</p>
<h1 id="simple-example">Simple Example</h1>
<p><code>bin/name.ts</code></p>
<pre data-lang="tsx" style="background-color:#2b303b;color:#c0c5ce;" class="language-tsx "><code class="language-tsx" data-lang="tsx"><span style="color:#65737e;">#!/usr/bin/env node
</span><span style="color:#b48ead;">import </span><span style="color:#d08770;">* </span><span style="color:#b48ead;">as </span><span style="color:#bf616a;">cdk </span><span style="color:#b48ead;">from </span><span>&#39;</span><span style="color:#a3be8c;">aws-cdk-lib</span><span>&#39;;
</span><span style="color:#b48ead;">import </span><span>{ </span><span style="color:#bf616a;">CdkWorkshopStack </span><span>} </span><span style="color:#b48ead;">from </span><span>&#39;</span><span style="color:#a3be8c;">../lib/cdk-workshop-stack</span><span>&#39;;
</span><span>
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">app </span><span>= new cdk.App();
</span><span>new CdkWorkshopStack(</span><span style="color:#bf616a;">app</span><span>, &#39;</span><span style="color:#a3be8c;">CdkWorkshopStack</span><span>&#39;);
</span></code></pre>
<p>All this does is load and instantiate the <code>name</code> stack.</p>
<p>Who cares. Moving on.</p>
<p>Now let‚Äôs look at <code>lib/name-stack.ts</code></p>
<pre data-lang="tsx" style="background-color:#2b303b;color:#c0c5ce;" class="language-tsx "><code class="language-tsx" data-lang="tsx"><span style="color:#b48ead;">import </span><span style="color:#d08770;">* </span><span style="color:#b48ead;">as </span><span style="color:#bf616a;">cdk </span><span style="color:#b48ead;">from </span><span>&#39;</span><span style="color:#a3be8c;">aws-cdk-lib</span><span>&#39;;
</span><span style="color:#b48ead;">import </span><span style="color:#d08770;">* </span><span style="color:#b48ead;">as </span><span style="color:#bf616a;">sns </span><span style="color:#b48ead;">from </span><span>&#39;</span><span style="color:#a3be8c;">aws-cdk-lib/aws-sns</span><span>&#39;;
</span><span style="color:#b48ead;">import </span><span style="color:#d08770;">* </span><span style="color:#b48ead;">as </span><span style="color:#bf616a;">subs </span><span style="color:#b48ead;">from </span><span>&#39;</span><span style="color:#a3be8c;">aws-cdk-lib/aws-sns-subscriptions</span><span>&#39;;
</span><span style="color:#b48ead;">import </span><span style="color:#d08770;">* </span><span style="color:#b48ead;">as </span><span style="color:#bf616a;">sqs </span><span style="color:#b48ead;">from </span><span>&#39;</span><span style="color:#a3be8c;">aws-cdk-lib/aws-sqs</span><span>&#39;;
</span><span>
</span><span style="color:#b48ead;">export class </span><span style="color:#ebcb8b;">CdkWorkshopStack </span><span style="color:#b48ead;">extends </span><span style="color:#eff1f5;">cdk.</span><span style="color:#a3be8c;">Stack </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">  </span><span style="color:#b48ead;">constructor</span><span>(</span><span style="color:#bf616a;">scope</span><span>: </span><span style="color:#eff1f5;">cdk.App, </span><span style="color:#bf616a;">id</span><span>: </span><span style="color:#eff1f5;">string, </span><span style="color:#bf616a;">props</span><span>?: </span><span style="color:#eff1f5;">cdk.StackProps</span><span>) </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    </span><span style="color:#bf616a;">super</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">scope</span><span style="color:#eff1f5;">, </span><span style="color:#bf616a;">id</span><span style="color:#eff1f5;">, </span><span style="color:#bf616a;">props</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">queue </span><span>= new </span><span style="color:#eff1f5;">sqs.Queue(</span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">, </span><span>&#39;</span><span style="color:#a3be8c;">CdkWorkshopQueue</span><span>&#39;</span><span style="color:#eff1f5;">, {
</span><span style="color:#eff1f5;">      visibilityTimeout: </span><span style="color:#bf616a;">cdk</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">Duration</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">seconds</span><span style="color:#eff1f5;">(</span><span style="color:#d08770;">300</span><span style="color:#eff1f5;">)
</span><span style="color:#eff1f5;">    });
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">topic </span><span>= new </span><span style="color:#eff1f5;">sns.Topic(</span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">, </span><span>&#39;</span><span style="color:#a3be8c;">CdkWorkshopTopic</span><span>&#39;</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#bf616a;">topic</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">addSubscription</span><span style="color:#eff1f5;">(</span><span>new </span><span style="color:#eff1f5;">subs.SqsSubscription(</span><span style="color:#bf616a;">queue</span><span style="color:#eff1f5;">));
</span><span style="color:#eff1f5;">  }
</span><span style="color:#eff1f5;">}
</span></code></pre>
<p>This does three main things:</p>
<ol>
<li>Creates an SQS Queue</li>
<li>SNS Topic</li>
<li>Subscribes the <code>1</code> to receive any messages published to <code>2</code></li>
</ol>
<h2 id="scope-id-and-props"><code>scope</code> , <code>id</code>, and <code>props</code></h2>
<p><code>scope</code> is always the first argument in which constructs are created. Usually you just pass in <code>this</code>, because you want to define constructs with the current construct.</p>
<p><code>id</code> is the local identity of the construct, a unique way to refer to it with its scope.</p>
<p><code>props</code> are initialization properties. The lambda props accepts properties like <code>runtime</code>, <code>code</code>, <code>handler</code> name.</p>
<h1 id="our-example-creating-an-s3-bucket">Our example: creating an S3 bucket</h1>
<p>First of all I had to add a couple environment variables:</p>
<ul>
<li><code>CDK_DEFAULT_ACCOUNT</code></li>
<li><code>CDK_DEFAULT_REGION</code></li>
</ul>
<p>Then I ran <code>cdk synth</code> to see if everything looked good.</p>
<p>Then I ran <code>cdk bootstrap</code> which creates a ‚Äúbootstrap stack‚Äù for the app.</p>
<p>Now I have a bunch of roles, a bucket, etc.</p>
<p>Finally, I do:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">cdk</span><span> deploy
</span></code></pre>
<p>Now lets add some changes:</p>
<pre data-lang="tsx" style="background-color:#2b303b;color:#c0c5ce;" class="language-tsx "><code class="language-tsx" data-lang="tsx"><span style="color:#b48ead;">import </span><span style="color:#d08770;">* </span><span style="color:#b48ead;">as </span><span style="color:#bf616a;">cdk </span><span style="color:#b48ead;">from </span><span>&#39;</span><span style="color:#a3be8c;">aws-cdk-lib</span><span>&#39;;
</span><span style="color:#b48ead;">import </span><span>{ </span><span style="color:#bf616a;">Construct </span><span>} </span><span style="color:#b48ead;">from </span><span>&#39;</span><span style="color:#a3be8c;">constructs</span><span>&#39;;
</span><span style="color:#b48ead;">import </span><span>{ </span><span style="color:#bf616a;">aws_s3 </span><span style="color:#b48ead;">as </span><span style="color:#bf616a;">s3 </span><span>} </span><span style="color:#b48ead;">from </span><span>&#39;</span><span style="color:#a3be8c;">aws-cdk-lib</span><span>&#39;
</span><span>
</span><span style="color:#b48ead;">export class </span><span style="color:#ebcb8b;">CdkWorkshopStack </span><span style="color:#b48ead;">extends </span><span style="color:#eff1f5;">cdk.</span><span style="color:#a3be8c;">Stack </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">  </span><span style="color:#b48ead;">constructor</span><span>(</span><span style="color:#bf616a;">scope</span><span>: </span><span style="color:#eff1f5;">Construct, </span><span style="color:#bf616a;">id</span><span>: </span><span style="color:#eff1f5;">string, </span><span style="color:#bf616a;">props</span><span>?: </span><span style="color:#eff1f5;">cdk.StackProps</span><span>) </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    </span><span style="color:#bf616a;">super</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">scope</span><span style="color:#eff1f5;">, </span><span style="color:#bf616a;">id</span><span style="color:#eff1f5;">, </span><span style="color:#bf616a;">props</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span>new </span><span style="color:#eff1f5;">s3.Bucket(</span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">, </span><span>&#39;</span><span style="color:#a3be8c;">MyThirdBucket</span><span>&#39;</span><span style="color:#eff1f5;">, {
</span><span style="color:#eff1f5;">        versioned: </span><span style="color:#d08770;">true</span><span style="color:#eff1f5;">,
</span><span style="color:#eff1f5;">        removalPolicy: </span><span style="color:#bf616a;">cdk</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">RemovalPolicy</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">DESTROY</span><span style="color:#eff1f5;">,
</span><span style="color:#eff1f5;">        autoDeleteObjects: </span><span style="color:#d08770;">true
</span><span style="color:#eff1f5;">    });
</span><span style="color:#eff1f5;">  }
</span><span style="color:#eff1f5;">}
</span></code></pre>
<p>And then run <code>cdk diff</code>:</p>
<h1 id="what-else-can-you-do">What else can you do?</h1>
<p>Check the docs: <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html">class Bucket (construct) ¬∑ AWS CDK</a></p>
<h1 id="important-commands">Important Commands</h1>
<p><code>cdk bootstrap</code></p>
<ul>
<li>This installs a ‚Äúbootstrap stack‚Äù of AWS stuff that will be used to create your stack</li>
<li>This stack includes resources that are used in the toolkit‚Äôs operation</li>
<li>For example, you can store code in an S3 bucket and use that during the deployment process</li>
</ul>
<p><code>cdk synth</code> </p>
<ul>
<li>generates the cloudformation templates</li>
</ul>
<p><code>cdk deploy</code></p>
<ul>
<li>actually deploys to <code>aws</code></li>
</ul>
<p><code>cdk diff</code></p>
<ul>
<li>if you make changes to the <code>cdk</code> this will show you what‚Äôs been changes</li>
</ul>
<p><code>cdk deploy --hotswap</code></p>
<ul>
<li>this will try to update the infrastructure you currently have with any changes you make</li>
<li>for example if you want to disable versioning for a bucket or change it‚Äôs privacy settings</li>
</ul>
<p><code>cdk watch</code></p>
<ul>
<li>this will watch your code for changes and try to deploy if it can</li>
<li>but you can only make asset changes</li>
<li>for example you cannot disable/enable versioning but you can adda picture/data to the contents of the bucket</li>
</ul>
<p>note: These commands deliberately introduces drift in CloudFormation stacks in order to speed up deployments.</p>
<p>Drift is when you cloud formation templates don‚Äôt match your actual stack.</p>
<p><code>cdk destroy</code></p>
<ul>
<li>destroys stuff üíÄ </li>
</ul>
<h1 id="what-is-aws-lambda">What is AWS Lambda</h1>
<p>AWS Lambda is a serverless, event-driven compute service that lets you run code for virtually any type of application or backend service without provisioning or managing servers. </p>
<p>What do you need:</p>
<ul>
<li>a name</li>
<li>a trigger</li>
<li>code (either a script or an executable in a zip)</li>
<li>a runtime</li>
<li>(optional) layers</li>
</ul>
<h2 id="what-is-a-layer">What is a layer?</h2>
<p>A layer is a ZIP archive that contains libraries, a custom runtime, or other dependencies. With layers, you can use libraries in your function without needing to include them in your deployment package.</p>
<h1 id="let-s-use-lambda">Let‚Äôs use lambda</h1>
<p>Adding an AWS lambda function</p>
<ol>
<li>create a directory <code>lambda</code> in the root of the CDK app</li>
<li>add a line to <code>.gitignore</code> to NOT ignore all the <code>.js</code> files in lambda</li>
</ol>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>!lambda/*
</span></code></pre>
<ol start="3">
<li>add the following js file, <code>lambda/hello.js</code></li>
</ol>
<pre data-lang="tsx" style="background-color:#2b303b;color:#c0c5ce;" class="language-tsx "><code class="language-tsx" data-lang="tsx"><span>exports.</span><span style="color:#8fa1b3;">handler </span><span>= </span><span style="color:#b48ead;">async function</span><span>(</span><span style="color:#bf616a;">event</span><span>) {
</span><span>  </span><span style="color:#ebcb8b;">console</span><span>.</span><span style="color:#96b5b4;">log</span><span>(&quot;</span><span style="color:#a3be8c;">request:</span><span>&quot;, JSON.</span><span style="color:#96b5b4;">stringify</span><span>(event, </span><span style="color:#d08770;">undefined</span><span>, </span><span style="color:#d08770;">2</span><span>));
</span><span>  </span><span style="color:#b48ead;">return </span><span>{
</span><span>    statusCode: </span><span style="color:#d08770;">200</span><span>,
</span><span>    headers: { &quot;</span><span style="color:#a3be8c;">Content-Type</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">text/plain</span><span>&quot; },
</span><span>    body: `</span><span style="color:#a3be8c;">Hello, CDK! You&#39;ve hit ${event.</span><span style="color:#bf616a;">path</span><span style="color:#a3be8c;">}</span><span style="color:#96b5b4;">\n</span><span>`
</span><span>  };
</span><span>};
</span></code></pre>
<p>This is a lambda function that always returns the text <strong>‚ÄúHello, CDK! You‚Äôve hit [url path]‚Äù</strong></p>
<p>To define an AWS Lambda function you need to use the <strong>AWS Construct Library.</strong></p>
<p>The construct library is divided into modules.</p>
<pre data-lang="tsx" style="background-color:#2b303b;color:#c0c5ce;" class="language-tsx "><code class="language-tsx" data-lang="tsx"><span style="color:#b48ead;">import </span><span style="color:#d08770;">* </span><span style="color:#b48ead;">as </span><span style="color:#bf616a;">cdk </span><span style="color:#b48ead;">from </span><span>&#39;</span><span style="color:#a3be8c;">aws-cdk-lib</span><span>&#39;;
</span><span style="color:#b48ead;">import </span><span style="color:#d08770;">* </span><span style="color:#b48ead;">as </span><span style="color:#bf616a;">lambda </span><span style="color:#b48ead;">from </span><span>&#39;</span><span style="color:#a3be8c;">aws-cdk-lib/aws-lambda</span><span>&#39;;
</span><span>
</span><span style="color:#b48ead;">export class </span><span style="color:#ebcb8b;">CdkWorkshopStack </span><span style="color:#b48ead;">extends </span><span style="color:#eff1f5;">cdk.</span><span style="color:#a3be8c;">Stack </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">  </span><span style="color:#b48ead;">constructor</span><span>(</span><span style="color:#bf616a;">scope</span><span>: </span><span style="color:#eff1f5;">cdk.App, </span><span style="color:#bf616a;">id</span><span>: </span><span style="color:#eff1f5;">string, </span><span style="color:#bf616a;">props</span><span>?: </span><span style="color:#eff1f5;">cdk.StackProps</span><span>) </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    </span><span style="color:#bf616a;">super</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">scope</span><span style="color:#eff1f5;">, </span><span style="color:#bf616a;">id</span><span style="color:#eff1f5;">, </span><span style="color:#bf616a;">props</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#65737e;">// defines an AWS Lambda resource
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">hello </span><span>= new </span><span style="color:#eff1f5;">lambda.Function(</span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">, </span><span>&#39;</span><span style="color:#a3be8c;">HelloHandler</span><span>&#39;</span><span style="color:#eff1f5;">, {
</span><span style="color:#eff1f5;">      runtime: </span><span style="color:#bf616a;">lambda</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">Runtime</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">NODEJS_16_X</span><span style="color:#eff1f5;">,    </span><span style="color:#65737e;">// runtime
</span><span style="color:#eff1f5;">      code: </span><span style="color:#bf616a;">lambda</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">Code</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">fromAsset</span><span style="color:#eff1f5;">(</span><span>&#39;</span><span style="color:#a3be8c;">lambda</span><span>&#39;</span><span style="color:#eff1f5;">),  </span><span style="color:#65737e;">// code loaded from our &quot;lambda&quot; directory
</span><span style="color:#eff1f5;">      handler: </span><span>&#39;</span><span style="color:#a3be8c;">hello.handler</span><span>&#39;                </span><span style="color:#65737e;">// file is &quot;hello&quot;, function is &quot;handler&quot;
</span><span style="color:#eff1f5;">    });
</span><span style="color:#eff1f5;">  }
</span><span style="color:#eff1f5;">}
</span></code></pre>
<h1 id="testing-lambda">Testing Lambda</h1>
<ul>
<li>go to test menu</li>
<li>select an apigateway-aws-proxy test from the drop down</li>
<li>hit test</li>
</ul>
<h1 id="using-cdk-watch">Using CDK watch</h1>
<p>Note: since it is a typescript project and we are using javascript in the lambda function, we have to update <code>cdk.json</code> to not exclude the files</p>
<h1 id="adding-rest-trigger">Adding REST trigger</h1>
<p>To actually interact with a lambda function from outside of the AWS console you have to give it some kind of trigger.</p>
<p>An obvious example would be, watching for uploads to an S3 bucket.</p>
<p>What we can also do is expose a rest api call that call the lambda function. </p>
<p>The most sensible way to do that would be to use API Gateway, an AWS service to expose public HTTP endpoints.</p>
<pre data-lang="tsx" style="background-color:#2b303b;color:#c0c5ce;" class="language-tsx "><code class="language-tsx" data-lang="tsx"><span style="color:#b48ead;">import </span><span style="color:#d08770;">* </span><span style="color:#b48ead;">as </span><span style="color:#bf616a;">cdk </span><span style="color:#b48ead;">from </span><span>&#39;</span><span style="color:#a3be8c;">aws-cdk-lib</span><span>&#39;;
</span><span style="color:#b48ead;">import </span><span style="color:#d08770;">* </span><span style="color:#b48ead;">as </span><span style="color:#bf616a;">lambda </span><span style="color:#b48ead;">from </span><span>&#39;</span><span style="color:#a3be8c;">aws-cdk-lib/aws-lambda</span><span>&#39;;
</span><span style="color:#b48ead;">import </span><span style="color:#d08770;">* </span><span style="color:#b48ead;">as </span><span style="color:#bf616a;">apigw </span><span style="color:#b48ead;">from </span><span>&#39;</span><span style="color:#a3be8c;">aws-cdk-lib/aws-apigateway</span><span>&#39;;
</span><span>
</span><span style="color:#b48ead;">export class </span><span style="color:#ebcb8b;">CdkWorkshopStack </span><span style="color:#b48ead;">extends </span><span style="color:#eff1f5;">cdk.</span><span style="color:#a3be8c;">Stack </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">  </span><span style="color:#b48ead;">constructor</span><span>(</span><span style="color:#bf616a;">scope</span><span>: </span><span style="color:#eff1f5;">cdk.App, </span><span style="color:#bf616a;">id</span><span>: </span><span style="color:#eff1f5;">string, </span><span style="color:#bf616a;">props</span><span>?: </span><span style="color:#eff1f5;">cdk.StackProps</span><span>) </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    </span><span style="color:#bf616a;">super</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">scope</span><span style="color:#eff1f5;">, </span><span style="color:#bf616a;">id</span><span style="color:#eff1f5;">, </span><span style="color:#bf616a;">props</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#65737e;">// defines an AWS Lambda resource
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">hello </span><span>= new </span><span style="color:#eff1f5;">lambda.Function(</span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">, </span><span>&#39;</span><span style="color:#a3be8c;">HelloHandler</span><span>&#39;</span><span style="color:#eff1f5;">, {
</span><span style="color:#eff1f5;">      runtime: </span><span style="color:#bf616a;">lambda</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">Runtime</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">NODEJS_14_X</span><span style="color:#eff1f5;">,    </span><span style="color:#65737e;">// execution environment
</span><span style="color:#eff1f5;">      code: </span><span style="color:#bf616a;">lambda</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">Code</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">fromAsset</span><span style="color:#eff1f5;">(</span><span>&#39;</span><span style="color:#a3be8c;">lambda</span><span>&#39;</span><span style="color:#eff1f5;">),  </span><span style="color:#65737e;">// code loaded from &quot;lambda&quot; directory
</span><span style="color:#eff1f5;">      handler: </span><span>&#39;</span><span style="color:#a3be8c;">hello.handler</span><span>&#39;                </span><span style="color:#65737e;">// file is &quot;hello&quot;, function is &quot;handler&quot;
</span><span style="color:#eff1f5;">    });
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#65737e;">// defines an API Gateway REST API resource backed by our &quot;hello&quot; function.
</span><span style="color:#eff1f5;">    </span><span>new </span><span style="color:#eff1f5;">apigw.LambdaRestApi(</span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">, </span><span>&#39;</span><span style="color:#a3be8c;">Endpoint</span><span>&#39;</span><span style="color:#eff1f5;">, {
</span><span style="color:#eff1f5;">      handler: </span><span style="color:#bf616a;">hello
</span><span style="color:#eff1f5;">    });
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">  }
</span><span style="color:#eff1f5;">}
</span></code></pre>
<h1 id="life-lessons">Life Lessons</h1>
<ul>
<li>GUIs suck (I always knew this actually)</li>
<li>‚Äúuse things the way they are intended to be used‚Äù - paraphrasing jim</li>
</ul>
<h1 id="questions-thoughts">Questions &amp; Thoughts</h1>
<h2 id="terraform-vs-cdks">Terraform vs. CDKs</h2>
<p>Disclaimer: i don‚Äôt know what I‚Äôm talking about.</p>
<p>Terraform uses a JSON-like language to define resources and other data, the HCL, or HashiCorp Configuration Language.</p>
<p>CDKs use code which then generates CloudFormation Templates in Json/yaml.</p>
<p>Terraform works on a lot of platforms, CDK is AWS specific.</p>
<p>Terraform is more reusable. You can ‚Äúreuse‚Äù CDK code but you cannot ‚Äúcreate your own modules‚Äù.</p>
<h2 id="cuelang-would-be-interesting-for-this-kinda-thing-i-think">Cuelang would be interesting for this kinda thing I THINK</h2>
<p>Disclaimer: i don‚Äôt know what I‚Äôm talking about here either. </p>
<p><a href="https://cuelang.org/">CUE (Configure Unify Execute)</a></p>
<p>Not a ‚Äúfull‚Äù programming language. It‚Äôs kinda like Jsonnet.</p>
<p>CUE is written in Go.</p>
<blockquote>
<p>The CUE language has an unusual property which sets it apart from many other languages and formats - types and values are the same.¬†<em>Not the same as only same type of structure, like JSON and JSON Schema,</em>¬†<strong><em>but actually the same</em>.</strong></p>
</blockquote>
<p>An aws example I found:</p>
<p><a href="https://tidycloudaws.com/take-a-cue-to-supercharge-your-configurations/">Take a cue to supercharge your configurations</a></p>
<p>Can create reusable definitions.</p>
<h1 id="fun-fact">Fun Fact</h1>
<p>I went to a golang meetup last week and this guy pronounced <code>fmt</code> as <em>fumpt</em> üò≥</p>


</div>


    </div>
  </section>
</body>
</html>

